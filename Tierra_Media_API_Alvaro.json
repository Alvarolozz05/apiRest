{
  "info": {
    "name": "Tierra Media API Alvaro - Tests Completos",
    "description": "Colección para comprobar todos los endpoints y relaciones de la API REST de Tierra Media",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost/api" },
    { "key": "region_id", "value": "" },
    { "key": "realm_id", "value": "" },
    { "key": "hero_id", "value": "" },
    { "key": "creature_id", "value": "" },
    { "key": "artifact_id", "value": "" }
  ],
  "item": [
    {
      "name": "POST Region",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": "{{base_url}}/regions",
        "body": { "mode": "raw", "raw": "{ \"name\": \"Region_Test\" }" }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.expect(pm.response.code).to.be.oneOf([200,201]);",
              "pm.environment.set('region_id', pm.response.json().id);"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Region by ID",
      "request": { "method": "GET", "url": "{{base_url}}/regions/{{region_id}}" }
    },
    {
      "name": "GET Regions",
      "request": { "method": "GET", "url": "{{base_url}}/regions" }
    },
    {
      "name": "POST Realm",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": "{{base_url}}/realms",
        "body": {
          "mode": "raw",
          "raw": "{ \"name\": \"Realm_Test\", \"ruler\": \"King\", \"alignment\": \"Neutral\", \"region_id\": {{region_id}} }"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.expect(pm.response.code).to.be.oneOf([200,201]);",
              "pm.environment.set('realm_id', pm.response.json().id);"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Realm by ID",
      "request": { "method": "GET", "url": "{{base_url}}/realms/{{realm_id}}" },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const realm = pm.response.json();",
              "pm.test('Realm básico', () => {",
              "    pm.expect(realm.id).to.eql(parseInt(pm.variables.get('realm_id')));",
              "    pm.expect(realm.name).to.be.a('string').that.is.not.empty;",
              "    pm.expect(realm.ruler).to.be.a('string').that.is.not.empty;",
              "    pm.expect(realm.alignment).to.be.oneOf(['Bien','Mal','Neutral']);",
              "});",
              "pm.test('Realm tiene region válida', () => {",
              "    pm.expect(realm.region).to.be.an('object');",
              "    pm.expect(realm.region.id).to.be.a('number');",
              "    pm.expect(realm.region.name).to.be.a('string').that.is.not.empty;",
              "});",
              "pm.test('Realm tiene heroes válidos', () => {",
              "    pm.expect(realm.heroes).to.be.an('array');",
              "    realm.heroes.forEach(hero => {",
              "        pm.expect(hero.id).to.be.a('number');",
              "        pm.expect(hero.name).to.be.a('string').that.is.not.empty;",
              "        pm.expect(hero.race).to.be.a('string');",
              "        pm.expect(hero.rank).to.be.a('string');",
              "        pm.expect(hero.alive).to.be.a('boolean');",
              "    });",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Realms",
      "request": { "method": "GET", "url": "{{base_url}}/realms" }
    },
    {
      "name": "POST Hero",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": "{{base_url}}/heroes",
        "body": {
          "mode": "raw",
          "raw": "{ \"name\": \"Hero_Test\", \"race\": \"Humano\", \"rank\": \"Explorador\", \"realm_id\": {{realm_id}}, \"alive\": true }"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.expect(pm.response.code).to.be.oneOf([200,201]);",
              "pm.environment.set('hero_id', pm.response.json().id);"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Hero by ID",
      "request": { "method": "GET", "url": "{{base_url}}/heroes/{{hero_id}}" },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const hero = pm.response.json();",
              "pm.test('Hero básico', () => {",
              "    pm.expect(hero.id).to.eql(parseInt(pm.variables.get('hero_id')));",
              "    pm.expect(hero.name).to.be.a('string').that.is.not.empty;",
              "    pm.expect(hero.race).to.be.a('string');",
              "    pm.expect(hero.rank).to.be.a('string');",
              "    pm.expect(hero.alive).to.be.a('boolean');",
              "});",
              "pm.test('Hero tiene realm válido', () => {",
              "    pm.expect(hero.realm).to.be.an('object');",
              "    pm.expect(hero.realm.id).to.eql(parseInt(pm.variables.get('realm_id')));",
              "});",
              "pm.test('Hero tiene artifacts válidos', () => {",
              "    pm.expect(hero.artifacts).to.be.an('array');",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Heroes",
      "request": { "method": "GET", "url": "{{base_url}}/heroes" }
    },
    {
      "name": "POST Creature",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": "{{base_url}}/creatures",
        "body": {
          "mode": "raw",
          "raw": "{ \"name\": \"Creature_Test\", \"species\": \"Bestia\", \"threat_level\": 5, \"region_id\": {{region_id}} }"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.expect(pm.response.code).to.be.oneOf([200,201]);",
              "pm.environment.set('creature_id', pm.response.json().id);"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Creature by ID",
      "request": { "method": "GET", "url": "{{base_url}}/creatures/{{creature_id}}" }
    },
    {
      "name": "GET Creatures",
      "request": { "method": "GET", "url": "{{base_url}}/creatures" }
    },
    {
      "name": "POST Artifact",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": "{{base_url}}/artifacts",
        "body": {
          "mode": "raw",
          "raw": "{ \"name\": \"Artifact_Test\", \"type\": \"Espada\", \"origin_realm_id\": {{realm_id}}, \"power_level\": 75, \"description\": \"Espada legendaria\", \"hero_ids\": [{{hero_id}}] }"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.expect(pm.response.code).to.be.oneOf([200,201]);",
              "pm.environment.set('artifact_id', pm.response.json().id);"
            ]
          }
        }
      ]
    },
    {
      "name": "GET Artifact by ID",
      "request": { "method": "GET", "url": "{{base_url}}/artifacts/{{artifact_id}}" }
    },
    {
      "name": "GET Artifacts",
      "request": { "method": "GET", "url": "{{base_url}}/artifacts" }
    },
    {
      "name": "DELETE Artifact",
      "request": { "method": "DELETE", "url": "{{base_url}}/artifacts/{{artifact_id}}" }
    },
    {
      "name": "DELETE Creature",
      "request": { "method": "DELETE", "url": "{{base_url}}/creatures/{{creature_id}}" }
    },
    {
      "name": "DELETE Hero",
      "request": { "method": "DELETE", "url": "{{base_url}}/heroes/{{hero_id}}" }
    },
    {
      "name": "DELETE Realm",
      "request": { "method": "DELETE", "url": "{{base_url}}/realms/{{realm_id}}" }
    },
    {
      "name": "DELETE Region",
      "request": { "method": "DELETE", "url": "{{base_url}}/regions/{{region_id}}" }
    }
  ]
}